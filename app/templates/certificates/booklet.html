<!DOCTYPE html>
<html>
<head>
    <title>User Booklet</title>
    <style>
        @page {
            size: landscape;
            margin: 1cm; /* Adjust margins for better fit in landscape */
        }
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
        }
        h1, h2 {
            text-align: center;
            margin-bottom: 10px;
        }
        .header-info {
            text-align: center;
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            page-break-inside: auto; /* Allow table to break across pages */
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
            font-size: 0.8em; /* Smaller font for more content */
        }
        th {
            background-color: #f2f2f2;
        }
        tr {
            page-break-inside: avoid; /* Avoid breaking rows */
            page-break-after: auto; /* Allow page break after a row */
        }
        .no-competencies {
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Booklet for {{ user.full_name }}</h1>

    <div class="header-info">
        <p><strong>Date of Edition:</strong> {{ current_date.strftime('%Y-%m-%d %H:%M') }}</p>
        <p><strong>Team(s):</strong> 
            {% for team in user.teams %}
                {{ team.name }}{% if not loop.last %}, {% endif %}
            {% else %}
                N/A
            {% endfor %}
        </p>
    </div>

    <h2>Competencies</h2>
    {% if competencies %}
    <table>
        <thead>
            <tr>
                <th>Skill</th>
                <th>Level</th>
                <th>Species</th>
                <th>Tutor/Evaluator</th>
                <th>Initial Training</th>
                <th>Recycling Need</th>
                <th>Last Practice</th>
            </tr>
        </thead>
        <tbody>
            {% for competency in competencies %}
            <tr>
                <td>{{ competency.skill.name }}</td>
                <td>{{ competency.level }}</td>
                <td>
                    {% if competency.skill.species %}
                        {% for species in competency.skill.species %}
                            {{ species.name }}{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if competency.evaluator %}
                        {{ competency.evaluator.full_name }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>{{ competency.evaluation_date.strftime('%Y-%m-%d') }}</td>
                <td>
                    {% if competency.recycling_due_date %}
                        {{ competency.recycling_due_date.strftime('%Y-%m-%d') }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if competency.latest_practice_date %}
                        {{ competency.latest_practice_date.strftime('%Y-%m-%d') }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="no-competencies">No competencies found for this user.</p>
    {% endif %}
</body>
</html>
